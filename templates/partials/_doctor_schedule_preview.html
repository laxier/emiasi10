<div class="doctor-schedule-preview mt-3">
  {% if schedule_days %}
  <div class="d-flex justify-content-between align-items-center">
    <div class="small text-muted">Последнее сохранённое расписание</div>
    {% if doctor %}
      <a href="{{ url_for('edit_track', doctor_id=doctor.doctor_api_id) }}?refresh=1" class="btn btn-sm btn-outline-primary"><i class="fas fa-sync"></i> Обновить</a>
    {% elif preview_doctor_id %}
      <a href="{{ url_for('add_track') }}?doctor_id={{ preview_doctor_id }}&refresh=1" class="btn btn-sm btn-outline-primary"><i class="fas fa-sync"></i> Обновить</a>
    {% endif %}
  </div>
  <table class="table table-sm table-bordered align-middle mb-2 mt-2">
    <thead class="table-light">
      <tr>
        <th>Дата</th>
        <th>День</th>
  <th>Покрытие</th>
  <th>Все слоты</th>
      </tr>
    </thead>
    <tbody>
      {% for d in schedule_days %}
      <tr class="{% if d.is_today %}table-info{% endif %}">
        <td>{{ d.date }}</td>
        <td>{{ d.weekday }}</td>
        <td style="min-width:85px;">
          {% if d.coverage == 'full' %}
            <span class="badge bg-success">FULL</span>
          {% elif d.coverage == 'partial' %}
            <span class="badge bg-warning text-dark">PART</span>
          {% elif d.coverage == 'none' %}
            <span class="badge bg-danger">NONE</span>
          {% else %}
            <span class="badge bg-secondary">?</span>
          {% endif %}
        </td>
        <td style="max-width:360px;">
          {% if d.slots %}
            <div class="small text-wrap">
              {% for s in d.slots %}
                <span class="badge bg-outline border text-dark fw-normal mb-1" style="border:1px solid #aaa;">{{ s.split(' ')[1] if ' ' in s else s }}</span>
              {% endfor %}
            </div>
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="small text-muted">Покрытие FULL = полностью; PART = частично; NONE = нет пересечения. Обновлено: {% if sched and sched.updated_at %}{{ sched.updated_at }}{% else %}—{% endif %}</div>
  {% else %}
    <div class="text-muted">Нет сохранённого расписания по этому врачу.</div>
  {% endif %}
</div>
